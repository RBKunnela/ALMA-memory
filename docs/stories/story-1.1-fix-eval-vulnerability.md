# Story ALMA-001: Fix eval() Security Vulnerability

**Story ID:** ALMA-001
**Epic:** ALMA Technical Debt Resolution
**Priority:** P0 (Critical)
**Points:** 2
**Sprint:** 1

---

## User Story

**As a** system administrator
**I want** the Neo4j graph store to safely parse properties
**So that** malicious data cannot execute arbitrary code

## Background

The Neo4j graph store uses Python's `eval()` function to parse stored properties, creating an arbitrary code execution vulnerability. This is a critical security issue that could lead to complete system compromise.

## Technical Details

**File:** `alma/graph/store.py`
**Lines:** 224, 262

**Current Code:**
```python
properties=eval(r["properties"]) if r["properties"] else {}
```

**Risk:** If an attacker can inject malicious Python code into the properties field, it will be executed when data is retrieved.

## Acceptance Criteria

- [ ] `eval()` is replaced with `json.loads()` or `ast.literal_eval()`
- [ ] Existing data can still be parsed
- [ ] Unit tests verify safe parsing
- [ ] Unit tests verify malicious payloads are rejected
- [ ] No performance regression in property parsing

## Implementation

### Option 1: JSON (Recommended)
```python
import json
properties = json.loads(r["properties"]) if r["properties"] else {}
```

### Option 2: AST Literal Eval
```python
import ast
properties = ast.literal_eval(r["properties"]) if r["properties"] else {}
```

## Test Cases

1. Parse valid JSON properties
2. Parse empty properties
3. Reject malicious code: `"__import__('os').system('rm -rf /')"`
4. Reject invalid JSON gracefully
5. Handle existing data formats

## Definition of Done

- [ ] Code changes implemented
- [ ] Security review completed
- [ ] Unit tests added
- [ ] Integration tests pass
- [ ] Documentation updated if needed

## Files to Modify

- `alma/graph/store.py` (lines 224, 262)
- `tests/test_graph_store.py` (add security tests)

---

**Estimated Effort:** 2 hours
